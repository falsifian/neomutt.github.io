<h1><a {% if page.url == '/arch' %} class="current" {% endif %} href="/arch">Architecture</a></h1>

{% assign parts = page.url | split: '/' %}

{% if parts[1] == 'arch' %}
  <ul>
  {% assign deep = false %}
  {% for f in site.arch %}
    {% assign current = f.url | split: '/' %}

    {% assign children = false %}

    {% if current.size < 4 %}
      {% if current[2] == 'diagram' %}
        {% assign children = true %}
      {% endif %}
      {% if deep == true %}
        </ul> {% assign deep = false %}
      {% endif %}
      {% include list-bold.html lb_path=f.url lb_title=f.title lb_desc=f.description %}
    {% else %}

      {% if page.url contains '/arch/diagram' %}
        {% if f.url contains '/arch/diagram/' %}
          {% if deep == false %}
            <ul> {% assign deep = true %}
          {% endif %}
          {% include list-bold.html lb_path=f.url lb_title=f.title lb_desc=f.description lb_desc=f.description %}
        {% endif %}
      {% endif %}

    {% endif %}

  {% endfor %}
  {% if deep %}
    </ul>
  {% endif %}
  </ul>
{% endif %}

